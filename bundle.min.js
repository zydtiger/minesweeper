!function e(t,i,n){function r(l,o){if(!i[l]){if(!t[l]){var a="function"==typeof require&&require;if(!o&&a)return a(l,!0);if(s)return s(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var h=i[l]={exports:{}};t[l][0].call(h.exports,(function(e){return r(t[l][1][e]||e)}),h,h.exports,e,t,i,n)}return i[l].exports}for(var s="function"==typeof require&&require,l=0;l<n.length;l++)r(n[l]);return r}({1:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Grid=void 0;const n=e("./lib");i.Grid=class{constructor(e,t,i){this.icons={mine:"💣",flag:"🚩",ques:"❔",death:"💀",win:"😎"},this.dx=[-1,-1,-1,0,0,1,1,1],this.dy=[-1,0,1,-1,1,-1,0,1],this.size=e,this.unlabelled_mines=t,this.total_mines=t,this.essentials=i,this.map=new Array(e.height).fill(0).map((()=>new Array(e.width).fill(0))),i.mine_label.innerHTML=(0,n.format)(t);for(let i=0;i<t;i++){let t=new n.Position((0,n.randint)(0,e.width),(0,n.randint)(0,e.height));for(;-1==this.map[t.y][t.x];)t=new n.Position((0,n.randint)(0,e.width),(0,n.randint)(0,e.height));this.map[t.y][t.x]=-1}let r=[-1,-1,-1,0,0,1,1,1],s=[-1,0,1,-1,1,-1,0,1];for(let t=0;t<e.height;t++)for(let i=0;i<e.width;i++)if(-1!=this.map[t][i])for(let l=0;l<r.length;l++){let o=new n.Position(i+r[l],t+s[l]);o.x<0||o.x>=e.width||o.y<0||o.y>=e.height||-1==this.map[o.y][o.x]&&this.map[t][i]++}console.log(this.map)}render(){for(let e=0;e<this.size.height;e++){let t=document.createElement("div");t.setAttribute("class","row");for(let i=0;i<this.size.width;i++){let n=document.createElement("div");if(n.setAttribute("class","block"),0!=this.map[e][i]){let t=document.createElement("div"),r={"-1":"font-size: 20px",1:"color: blue",2:"color: green",3:"color: red",4:"color: darkblue",5:"color: darkred",6:"color: orange",7:"color: #f035de",8:"color: purple"};t.setAttribute("style",r[`${this.map[e][i]}`]),t.innerHTML=-1==this.map[e][i]?this.icons.mine:`${this.map[e][i]}`,n.appendChild(t)}t.appendChild(n)}this.essentials.grid.appendChild(t)}for(let e=0;e<this.size.height;e++){let t=document.createElement("div");t.setAttribute("class","row");for(let i=0;i<this.size.width;i++){let n=document.createElement("div");n.setAttribute("class","cover"),n.setAttribute("onmousedown",`mousedownCover(event, ${i}, ${e})`);let r=document.createElement("div");n.appendChild(r),t.appendChild(n)}this.essentials.cover_grid.appendChild(t)}}reveal(e){this.essentials.cover_grid.children[e.y].children[e.x].classList.add("reveal")}revealAll(){for(let e=0;e<this.size.width;e++)for(let t=0;t<this.size.height;t++)this.reveal(new n.Position(e,t))}unreveal(e){this.essentials.cover_grid.children[e.y].children[e.x].classList.remove("reveal")}unrevealAll(){for(let e=0;e<this.size.width;e++)for(let t=0;t<this.size.height;t++)this.unreveal(new n.Position(e,t))}ongameover(e){this.gameover_callback=e}gameover(){var e;for(let e=0;e<this.size.width;e++)for(let t=0;t<this.size.height;t++)this.essentials.cover_grid.children[t].children[e].setAttribute("style","opacity: 0");this.essentials.face.innerHTML=this.icons.death,null===(e=this.gameover_callback)||void 0===e||e.call(this)}onwin(e){this.win_callback=e}win(){var e;this.essentials.face.innerHTML=this.icons.win,null===(e=this.win_callback)||void 0===e||e.call(this)}_in_bound(e){return e.x>=0&&e.x<this.size.width&&e.y>=0&&e.y<this.size.height}_dfs_open(e){for(let t=0;t<this.dx.length;t++){let i=new n.Position(e.x+this.dx[t],e.y+this.dy[t]);if(!this._in_bound(i))continue;let r=this.essentials.cover_grid.children[i.y].children[i.x];null==r.getAttribute("style")&&""==r.firstChild.innerHTML&&(r.setAttribute("style","opacity: 0"),0==this.map[i.y][i.x]&&this._dfs_open(i))}}tap(e){let t=this.essentials.cover_grid.children[e.y].children[e.x];if(""!=t.firstChild.innerHTML)return t.firstChild.innerHTML="",void(this.essentials.mine_label.innerHTML=(0,n.format)(++this.unlabelled_mines));-1==this.map[e.y][e.x]&&this.gameover(),t.setAttribute("style","opacity: 0"),0==this.map[e.y][e.x]&&this._dfs_open(e);let i=0;for(let e=0;e<this.size.width;e++)for(let t=0;t<this.size.height;t++)null==this.essentials.cover_grid.children[t].children[e].getAttribute("style")&&i++;i==this.total_mines&&this.win()}starttry(e){for(let t=0;t<this.dx.length;t++){let i=new n.Position(e.x+this.dx[t],e.y+this.dy[t]);if(!this._in_bound(i))continue;let r=this.essentials.cover_grid.children[i.y].children[i.x];null==r.getAttribute("style")&&""==r.firstChild.innerHTML&&r.classList.add("plain")}}try(e){let t=!0;for(let i=0;i<this.dx.length;i++){let r=new n.Position(e.x+this.dx[i],e.y+this.dy[i]);if(!this._in_bound(r))continue;let s=this.essentials.cover_grid.children[r.y].children[r.x];if(null==s.getAttribute("style")&&""==s.firstChild.innerHTML&&-1==this.map[r.y][r.x]){t=!1;break}}for(let i=0;i<this.dx.length;i++){let r=new n.Position(e.x+this.dx[i],e.y+this.dy[i]);if(!this._in_bound(r))continue;let s=this.essentials.cover_grid.children[r.y].children[r.x];null==s.getAttribute("style")&&""==s.firstChild.innerHTML&&(t?this.tap(r):s.classList.remove("plain"))}}flag(e){let t=this.essentials.cover_grid.children[e.y].children[e.x].firstChild;""==t.innerHTML?(t.innerHTML=this.icons.flag,this.unlabelled_mines--):(t.innerHTML="",this.unlabelled_mines++),this.essentials.mine_label.innerHTML=(0,n.format)(this.unlabelled_mines),this.unlabelled_mines<0?this.essentials.mine_label.setAttribute("style","color: green"):this.essentials.mine_label.setAttribute("style","")}}},{"./lib":3}],2:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const n=e("./lib"),r=e("./grid"),s=["😀","🙂","😐","🙁","☹️","😪"];let l,o,a=0;window.exec=e=>{console.log(e);let t=e.split(" ");try{let e={spawn:()=>{if(t.length>4)throw SyntaxError("Wrong number of args!");let e=parseInt(t[1]||"nan"),i=parseInt(t[2]||"nan"),n=parseInt(t[3]||"nan");window.init(isNaN(e)?void 0:e,isNaN(i)?void 0:i,isNaN(n)?void 0:n)},reveal:()=>{if(1==t.length)l.revealAll();else{if(3!=t.length)throw SyntaxError("Wrong number of args!");{let e=new n.Position(parseInt(t[1]),parseInt(t[2]));(0,n.assert)((()=>!isNaN(e.x)&&!isNaN(e.y))),l.reveal(e)}}},unreveal:()=>{if(1==t.length)l.unrevealAll();else{if(3!=t.length)throw SyntaxError("Wrong number of args!");{let e=new n.Position(parseInt(t[1]),parseInt(t[2]));(0,n.assert)((()=>!isNaN(e.x)&&!isNaN(e.y))),l.unreveal(e)}}},tap:()=>{if(3!=t.length)throw SyntaxError("Wrong number of args!");let e=new n.Position(parseInt(t[1]),parseInt(t[2]));(0,n.assert)((()=>!isNaN(e.x)&&!isNaN(e.y))),l.tap(e)},starttry:()=>{if(3!=t.length)throw SyntaxError("Wrong number of args!");let e=new n.Position(parseInt(t[1]),parseInt(t[2]));(0,n.assert)((()=>!isNaN(e.x)&&!isNaN(e.y))),l.starttry(e)},try:()=>{if(3!=t.length)throw SyntaxError("Wrong number of args!");let e=new n.Position(parseInt(t[1]),parseInt(t[2]));(0,n.assert)((()=>!isNaN(e.x)&&!isNaN(e.y))),l.try(e)},flag:()=>{if(3!=t.length)throw SyntaxError("Wrong number of args!");let e=new n.Position(parseInt(t[1]),parseInt(t[2]));(0,n.assert)((()=>!isNaN(e.x)&&!isNaN(e.y))),l.flag(e)},starttimer:()=>{if(1!=t.length)throw SyntaxError("Wrong number of args!");document.getElementById("face-status").innerHTML=s[0],document.getElementById("timer").innerHTML=(0,n.format)(a),o=window.setInterval((()=>{a++,document.getElementById("timer").innerHTML=(0,n.format)(a),document.getElementById("face-status").innerHTML=s[Math.floor(a/6e4)]}),1e3)},stoptimer:()=>{if(1!=t.length)throw SyntaxError("Wrong number of args!");window.clearInterval(o)}};if(-1==Object.keys(e).indexOf(t[0]))throw SyntaxError("Command nonexistent! Consider adding yourself :)");e[t[0]]()}catch(e){console.error(e)}},window.help=()=>{let e=document.querySelector("#popup h1");e.innerHTML="Docs",e.setAttribute("style","color: black"),document.querySelector("#popup iframe").setAttribute("style","display: block"),h()},window.cmdkeydown=(e,t)=>{"Enter"==e.code&&(window.exec(t),e.target.value="")};let d="";function h(){document.getElementById("popup-back").setAttribute("style","display: block"),document.getElementById("popup").setAttribute("style","display: flex")}function c(){window.mousedownCover=()=>{}}window.onmouseup=e=>{e.preventDefault(),d.length>0&&(window.exec(d),d="")},window.closePopup=()=>{document.getElementById("popup-back").setAttribute("style","display: none"),document.getElementById("popup").setAttribute("style","display: none"),document.querySelector("#popup iframe").setAttribute("style","display: none")},window.init=(e,t,i)=>{document.getElementById("grid").innerHTML="",document.getElementById("cover_grid").innerHTML="";let s=parseInt(localStorage.getItem("last_width")),o=parseInt(localStorage.getItem("last_height")),a=parseInt(localStorage.getItem("last_mine"));try{(0,n.assert)((()=>!isNaN(s)&&!isNaN(o)&&!isNaN(a)))}catch(e){console.error("Stored values invalid, using default"),s=10,o=10,a=10}s=null!=e?e:s,o=null!=t?t:o,a=null!=i?i:a,localStorage.setItem("last_width",`${s}`),localStorage.setItem("last_height",`${o}`),localStorage.setItem("last_mine",`${a}`);let u={grid:document.getElementById("grid"),cover_grid:document.getElementById("cover_grid"),mine_label:document.getElementById("mines-left"),face:document.getElementById("face-status")};l=new r.Grid(new n.Dimension(s,o),a,u),l.render(),l.ongameover((()=>{window.exec("stoptimer"),c();let e=document.querySelector("#popup h1");e.innerHTML="You LOSE!",e.setAttribute("style","color: red"),h()})),l.onwin((()=>{window.exec("stoptimer"),c();let e=document.querySelector("#popup h1");e.innerHTML="You WIN!",e.setAttribute("style","color: green"),h()})),window.mousedownCover=(e,t,i)=>{e.preventDefault(),2==e.button&&null==e.target.getAttribute("style")&&window.exec(`flag ${t} ${i}`),0==e.button&&(e.ctrlKey?(d=`try ${t} ${i}`,window.exec(`starttry ${t} ${i}`)):window.exec(`tap ${t} ${i}`))},window.exec("starttimer")},window.onload=()=>window.init()},{"./grid":1,"./lib":3}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.format=i.assert=i.randint=i.Position=i.Dimension=i.sleep=void 0,i.sleep=function(e){return new Promise((t=>setTimeout(t,e)))};i.Dimension=class{constructor(e=0,t=0){this.width=e,this.height=t}};i.Position=class{constructor(e=0,t=0){this.x=e,this.y=t}},i.randint=function(e,t){return Math.floor(Math.random()*(t-e)+e)},i.assert=function(e){if(!e())throw EvalError},i.format=function(e){let t=`${e}`;for(;t.length<4;)t="0"+t;return t}},{}]},{},[2]);
