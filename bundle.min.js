!function e(t,i,n){function s(o,l){if(!i[o]){if(!t[o]){var a="function"==typeof require&&require;if(!l&&a)return a(o,!0);if(r)return r(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var h=i[o]={exports:{}};t[o][0].call(h.exports,(function(e){return s(t[o][1][e]||e)}),h,h.exports,e,t,i,n)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Grid=void 0;const n=e("./lib");i.Grid=class{constructor(e,t,i){this.icons={mine:"💣",flag:"🚩",ques:"❔",death:"💀",win:"😎"},this.dx=[-1,-1,-1,0,0,1,1,1],this.dy=[-1,0,1,-1,1,-1,0,1],this.size=e,this.unlabelled_mines=t,this.total_mines=t,this.essentials=i,this.map=new Array(e.height).fill(0).map((()=>new Array(e.width).fill(0))),i.mine_label.innerHTML=(0,n.format)(t);for(let i=0;i<t;i++){let t=new n.Position((0,n.rand_int)(0,e.width),(0,n.rand_int)(0,e.height));for(;-1==this.map[t.y][t.x];)t=new n.Position((0,n.rand_int)(0,e.width),(0,n.rand_int)(0,e.height));this.map[t.y][t.x]=-1}for(let t=0;t<e.height;t++)for(let i=0;i<e.width;i++)if(-1!=this.map[t][i])for(let s=0;s<this.dx.length;s++){let r=new n.Position(i+this.dx[s],t+this.dy[s]);r.x<0||r.x>=e.width||r.y<0||r.y>=e.height||-1==this.map[r.y][r.x]&&this.map[t][i]++}console.log(this.map)}render(){for(let e=0;e<this.size.height;e++){let t=document.createElement("div");t.setAttribute("class","row");for(let i=0;i<this.size.width;i++){let n=document.createElement("div");if(n.setAttribute("class","block"),0!=this.map[e][i]){let t=document.createElement("div"),s={"-1":"font-size: 20px",1:"color: blue",2:"color: green",3:"color: red",4:"color: darkblue",5:"color: darkred",6:"color: orange",7:"color: #f035de",8:"color: purple"};t.setAttribute("style",s[`${this.map[e][i]}`]),t.innerHTML=-1==this.map[e][i]?this.icons.mine:`${this.map[e][i]}`,n.appendChild(t)}t.appendChild(n)}this.essentials.grid.appendChild(t)}for(let e=0;e<this.size.height;e++){let t=document.createElement("div");t.setAttribute("class","row");for(let i=0;i<this.size.width;i++){let n=document.createElement("div");n.setAttribute("class","cover"),n.setAttribute("onmousedown",`mousedownCover(event, ${i}, ${e})`);let s=document.createElement("div");n.appendChild(s),t.appendChild(n)}this.essentials.cover_grid.appendChild(t)}}_in_bound(e){return e.x>=0&&e.x<this.size.width&&e.y>=0&&e.y<this.size.height}_is_revealed(e){return null!=this._cover_at(e).getAttribute("style")}_is_flagged(e){return""!=this._cover_at(e).firstChild.innerHTML}_cover_at(e){return this.essentials.cover_grid.children[e.y].children[e.x]}_dfs_open(e){for(let t=0;t<this.dx.length;t++){let i=new n.Position(e.x+this.dx[t],e.y+this.dy[t]);!this._in_bound(i)||this._is_revealed(i)||this._is_flagged(i)||(this._cover_at(i).setAttribute("style","opacity: 0"),0==this.map[i.y][i.x]&&this._dfs_open(i))}}tap(e){let t=this._cover_at(e);if(this._is_flagged(e))return t.firstChild.innerHTML="",void(this.essentials.mine_label.innerHTML=(0,n.format)(++this.unlabelled_mines));-1==this.map[e.y][e.x]&&this.gameover(),t.setAttribute("style","opacity: 0"),0==this.map[e.y][e.x]&&this._dfs_open(e);let i=0;for(let e=0;e<this.size.width;e++)for(let t=0;t<this.size.height;t++)this._is_revealed(new n.Position(e,t))||i++;i==this.total_mines&&this.win()}starttry(e){if(this._is_revealed(e))for(let t=0;t<this.dx.length;t++){let i=new n.Position(e.x+this.dx[t],e.y+this.dy[t]);!this._in_bound(i)||this._is_revealed(i)||this._is_flagged(i)||this._cover_at(i).classList.add("plain")}}try(e){if(!this._is_revealed(e))return;let t=!0;for(let i=0;i<this.dx.length;i++){let s=new n.Position(e.x+this.dx[i],e.y+this.dy[i]);if(this._in_bound(s)&&!this._is_revealed(s)&&!this._is_flagged(s)&&-1==this.map[s.y][s.x]){t=!1;break}}for(let i=0;i<this.dx.length;i++){let s=new n.Position(e.x+this.dx[i],e.y+this.dy[i]);!this._in_bound(s)||this._is_revealed(s)||this._is_flagged(s)||(t?this.tap(s):this._cover_at(s).classList.remove("plain"))}}flag(e){let t=this._cover_at(e).firstChild;""==t.innerHTML?(t.innerHTML=this.icons.flag,this.unlabelled_mines--):(t.innerHTML="",this.unlabelled_mines++),this.essentials.mine_label.innerHTML=(0,n.format)(this.unlabelled_mines),this.unlabelled_mines<0?this.essentials.mine_label.setAttribute("style","color: green"):this.essentials.mine_label.setAttribute("style","")}ongameover(e){this.gameover_callback=e}gameover(){var e;for(let e=0;e<this.size.width;e++)for(let t=0;t<this.size.height;t++)this._cover_at(new n.Position(e,t)).setAttribute("style","opacity: 0");this.essentials.face.innerHTML=this.icons.death,null===(e=this.gameover_callback)||void 0===e||e.call(this)}onwin(e){this.win_callback=e}win(){var e;this.essentials.face.innerHTML=this.icons.win,null===(e=this.win_callback)||void 0===e||e.call(this)}reveal(e){this._cover_at(e).classList.add("reveal")}reveal_all(){for(let e=0;e<this.size.width;e++)for(let t=0;t<this.size.height;t++)this.reveal(new n.Position(e,t))}unreveal(e){this._cover_at(e).classList.remove("reveal")}unreveal_all(){for(let e=0;e<this.size.width;e++)for(let t=0;t<this.size.height;t++)this.unreveal(new n.Position(e,t))}}},{"./lib":3}],2:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const n=e("./lib"),s=e("./grid"),r=["😀","🙂","😐","🙁","☹️","😪"];let o,l,a=0;window.exec=e=>{console.log(e);let t=e.split(" ");try{let e={spawn:()=>{if(t.length>4)throw SyntaxError("Wrong number of args!");let e=parseInt(t[1]||"nan"),i=parseInt(t[2]||"nan"),n=parseInt(t[3]||"nan");window.init(isNaN(e)?void 0:e,isNaN(i)?void 0:i,isNaN(n)?void 0:n)},reveal:()=>{if(1==t.length)o.reveal_all();else{if(3!=t.length)throw SyntaxError("Wrong number of args!");{let e=new n.Position(parseInt(t[1]),parseInt(t[2]));(0,n.assert)((()=>!isNaN(e.x)&&!isNaN(e.y))),o.reveal(e)}}},unreveal:()=>{if(1==t.length)o.unreveal_all();else{if(3!=t.length)throw SyntaxError("Wrong number of args!");{let e=new n.Position(parseInt(t[1]),parseInt(t[2]));(0,n.assert)((()=>!isNaN(e.x)&&!isNaN(e.y))),o.unreveal(e)}}},tap:()=>{if(3!=t.length)throw SyntaxError("Wrong number of args!");let e=new n.Position(parseInt(t[1]),parseInt(t[2]));(0,n.assert)((()=>!isNaN(e.x)&&!isNaN(e.y))),o.tap(e)},starttry:()=>{if(3!=t.length)throw SyntaxError("Wrong number of args!");let e=new n.Position(parseInt(t[1]),parseInt(t[2]));(0,n.assert)((()=>!isNaN(e.x)&&!isNaN(e.y))),o.starttry(e)},try:()=>{if(3!=t.length)throw SyntaxError("Wrong number of args!");let e=new n.Position(parseInt(t[1]),parseInt(t[2]));(0,n.assert)((()=>!isNaN(e.x)&&!isNaN(e.y))),o.try(e)},flag:()=>{if(3!=t.length)throw SyntaxError("Wrong number of args!");let e=new n.Position(parseInt(t[1]),parseInt(t[2]));(0,n.assert)((()=>!isNaN(e.x)&&!isNaN(e.y))),o.flag(e)},start_timer:()=>{if(1!=t.length)throw SyntaxError("Wrong number of args!");document.getElementById("face-status").innerHTML=r[0],document.getElementById("timer").innerHTML=(0,n.format)(a),l=window.setInterval((()=>{a++,document.getElementById("timer").innerHTML=(0,n.format)(a),document.getElementById("face-status").innerHTML=r[Math.floor(a/6e4)]}),1e3)},stop_timer:()=>{if(1!=t.length)throw SyntaxError("Wrong number of args!");window.clearInterval(l)}};if(-1==Object.keys(e).indexOf(t[0]))throw SyntaxError("Command nonexistent! Consider adding yourself :)");e[t[0]]()}catch(e){console.error(e)}},window.help=()=>{let e=document.querySelector("#popup h1");e.innerHTML="Docs",e.setAttribute("style","color: black"),document.querySelector("#popup iframe").setAttribute("style","display: block"),h()},window.cmdkeydown=(e,t)=>{"Enter"==e.code&&(window.exec(t),e.target.value="")};let d="";function h(){document.getElementById("popup-back").setAttribute("style","display: block"),document.getElementById("popup").setAttribute("style","display: flex")}function c(){window.mousedownCover=()=>{}}window.onmouseup=e=>{e.preventDefault(),d.length>0&&(window.exec(d),d="")},window.closePopup=()=>{document.getElementById("popup-back").setAttribute("style","display: none"),document.getElementById("popup").setAttribute("style","display: none"),document.querySelector("#popup iframe").setAttribute("style","display: none")},window.init=(e,t,i)=>{document.getElementById("grid").innerHTML="",document.getElementById("cover_grid").innerHTML="";let r=parseInt(localStorage.getItem("last_width")),l=parseInt(localStorage.getItem("last_height")),a=parseInt(localStorage.getItem("last_mine"));try{(0,n.assert)((()=>!isNaN(r)&&!isNaN(l)&&!isNaN(a)))}catch(e){console.error("Stored values invalid, using default"),r=10,l=10,a=10}r=null!=e?e:r,l=null!=t?t:l,a=null!=i?i:a,localStorage.setItem("last_width",`${r}`),localStorage.setItem("last_height",`${l}`),localStorage.setItem("last_mine",`${a}`);let u={grid:document.getElementById("grid"),cover_grid:document.getElementById("cover_grid"),mine_label:document.getElementById("mines-left"),face:document.getElementById("face-status")};o=new s.Grid(new n.Dimension(r,l),a,u),o.render(),o.ongameover((()=>{window.exec("stop_timer"),c();let e=document.querySelector("#popup h1");e.innerHTML="You LOSE!",e.setAttribute("style","color: red"),h()})),o.onwin((()=>{window.exec("stop_timer"),c();let e=document.querySelector("#popup h1");e.innerHTML="You WIN!",e.setAttribute("style","color: green"),h()})),window.mousedownCover=(e,t,i)=>{e.preventDefault(),2==e.button&&null==e.target.getAttribute("style")&&window.exec(`flag ${t} ${i}`),0==e.button&&(e.ctrlKey?(d=`try ${t} ${i}`,window.exec(`starttry ${t} ${i}`)):window.exec(`tap ${t} ${i}`))},window.exec("start_timer")},window.onload=()=>window.init()},{"./grid":1,"./lib":3}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.format=i.assert=i.rand_int=i.Position=i.Dimension=i.sleep=void 0,i.sleep=function(e){return new Promise((t=>setTimeout(t,e)))};i.Dimension=class{constructor(e=0,t=0){this.width=e,this.height=t}};i.Position=class{constructor(e=0,t=0){this.x=e,this.y=t}},i.rand_int=function(e,t){return Math.floor(Math.random()*(t-e)+e)},i.assert=function(e){if(!e())throw EvalError},i.format=function(e){let t=`${e}`;for(;t.length<4;)t="0"+t;return t}},{}]},{},[2]);
